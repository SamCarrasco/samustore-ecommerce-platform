{% extends "dashboard/layout.html" %}

{% block dashboard_content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h3 mb-1">Mis Productos</h1>
      <div class="text-muted">Gestiona tu inventario de productos</div>
    </div>
    <a href="{{ url_for('dashboard.product_new') }}" class="btn btn-dark">
      <i class="bi bi-plus-lg me-1"></i> Agregar Producto
    </a>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-1">Lista de Productos</h5>
      <div class="text-muted small mb-3">
        Tienes {{ total or 0 }} productos en tu cat√°logo
      </div>

      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th style="width:72px;">Imagen</th>
              <th>Producto</th>
              <th class="text-end">Precio</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for p in products.items %}
            {% set is_local = p.image_url and (not p.image_url.startswith('http')) %}
            {% set thumb = (
                 url_for('static', filename=p.image_url) if is_local
                 else (p.image_url if p.image_url else url_for('static', filename='img/placeholder.png'))
            ) %}
            <tr>
              <td>
                <img src="{{ thumb }}" alt="{{ p.name }}" class="rounded"
                     style="width:56px;height:56px;object-fit:cover;background:#f1f3f5;">
              </td>
              <td class="fw-semibold">
                <div class="mb-0">{{ p.name }}</div>
                {% if p.description %}
                  <div class="text-muted small text-truncate" style="max-width: 420px;">
                    {{ p.description }}
                  </div>
                {% endif %}
              </td>
              <td class="text-end">
                <div class="fw-bold">${{ '%.2f'|format(p.price) }}</div>
                {% if p.original_price is not none and p.original_price > p.price %}
                  <div class="text-muted small" style="text-decoration: line-through;">
                    ${{ '%.2f'|format(p.original_price) }}
                  </div>
                {% endif %}
              </td>
              <td>
                {% if p.status == 'available' %}
                  <span class="badge bg-dark">Disponible</span>
                {% else %}
                  <span class="badge bg-secondary">No disponible</span>
                {% endif %}
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-secondary"
                   href="{{ url_for('dashboard.product_edit', id=p.id) }}">‚úèÔ∏è</a>
                <form action="{{ url_for('dashboard.product_delete', id=p.id) }}" method="POST" class="d-inline">
                  <button class="btn btn-sm btn-outline-danger" onclick="return confirm('¬øEliminar?')">üóëÔ∏è</button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="text-center text-muted">A√∫n no tienes productos.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if products.pages and products.pages > 1 %}
      <nav class="mt-3">
        <ul class="pagination justify-content-end mb-0">
          <li class="page-item {% if not products.has_prev %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('dashboard.index', page=products.prev_num) }}">Anterior</a>
          </li>
          <li class="page-item disabled">
            <span class="page-link">P√°gina {{ products.page }} / {{ products.pages }}</span>
          </li>
          <li class="page-item {% if not products.has_next %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('dashboard.index', page=products.next_num) }}">Siguiente</a>
          </li>
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
{% endblock %}
